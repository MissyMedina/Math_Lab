<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Engine Test Suite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .test-section { margin: 20px 0; border: 1px solid #ddd; padding: 15px; }
        .math-display { font-family: 'Courier New', monospace; background: #f8f9fa; padding: 10px; margin: 5px 0; }
        .step { margin: 5px 0; padding: 5px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Math Engine Validation Test Suite</h1>
    <div id="test-results"></div>

    <script src="polynomial-math.js"></script>
    <script>
        class MathEngineValidator {
            constructor() {
                this.testResults = [];
                this.runAllTests();
            }

            runAllTests() {
                console.log("Starting Math Engine Validation...");
                
                // Test polynomial creation and display
                this.testPolynomialCreation();
                
                // Test basic division cases
                this.testBasicDivision();
                
                // Test educational examples
                this.testEducationalExamples();
                
                // Test edge cases
                this.testEdgeCases();
                
                // Test problem generation
                this.testProblemGeneration();
                
                // Display results
                this.displayResults();
            }

            testPolynomialCreation() {
                this.addTestSection("Polynomial Creation and Display");
                
                // Test polynomial string representation
                const tests = [
                    { coeffs: [1, -2, 3], expected: "x^2 - 2x + 3" },
                    { coeffs: [2, 0, -1], expected: "2x^2 - 1" },
                    { coeffs: [1, 1], expected: "x + 1" },
                    { coeffs: [-1, 2], expected: "-x + 2" },
                    { coeffs: [3], expected: "3" },
                    { coeffs: [1, 0, 0, 1], expected: "x^3 + 1" }
                ];

                tests.forEach((test, i) => {
                    const poly = new Polynomial(test.coeffs);
                    const result = poly.toString();
                    const passed = result === test.expected;
                    this.addTestResult(`Polynomial Display Test ${i+1}`, passed, 
                        `Expected: ${test.expected}, Got: ${result}`);
                });
            }

            testBasicDivision() {
                this.addTestSection("Basic Division Validation");
                
                // Test 1: (x^2 + 3x + 2) ÷ (x + 1) = x + 2
                const dividend1 = new Polynomial([1, 3, 2]);
                const divisor1 = new Polynomial([1, 1]);
                const result1 = Polynomial.divide(dividend1, divisor1);
                
                this.addTestResult("Basic Division Test 1", 
                    result1.quotient.toString() === "x + 2" && result1.remainder.toString() === "0",
                    `(${dividend1.toString()}) ÷ (${divisor1.toString()}) = ${result1.quotient.toString()} R ${result1.remainder.toString()}`);

                // Test 2: (2x^2 + 5x + 3) ÷ (x + 1) = 2x + 3
                const dividend2 = new Polynomial([2, 5, 3]);
                const divisor2 = new Polynomial([1, 1]);
                const result2 = Polynomial.divide(dividend2, divisor2);
                
                this.addTestResult("Basic Division Test 2", 
                    result2.quotient.toString() === "2x + 3" && result2.remainder.toString() === "0",
                    `(${dividend2.toString()}) ÷ (${divisor2.toString()}) = ${result2.quotient.toString()} R ${result2.remainder.toString()}`);

                // Test 3: Division with remainder (x^2 + 1) ÷ (x + 1) = x - 1 R 2
                const dividend3 = new Polynomial([1, 0, 1]);
                const divisor3 = new Polynomial([1, 1]);
                const result3 = Polynomial.divide(dividend3, divisor3);
                
                this.addTestResult("Division with Remainder", 
                    result3.quotient.toString() === "x - 1" && result3.remainder.toString() === "2",
                    `(${dividend3.toString()}) ÷ (${divisor3.toString()}) = ${result3.quotient.toString()} R ${result3.remainder.toString()}`);
            }

            testEducationalExamples() {
                this.addTestSection("Educational Examples with Step Analysis");
                
                // Classic textbook example: (x^2 + 5x + 6) ÷ (x + 2)
                const dividend = new Polynomial([1, 5, 6]);
                const divisor = new Polynomial([1, 2]);
                const result = Polynomial.divide(dividend, divisor);
                
                console.log("Educational Example Steps:");
                result.steps.forEach(step => {
                    console.log(`Step ${step.step}: ${step.description}`);
                });
                
                const expectedQuotient = "x + 3";
                const expectedRemainder = "0";
                const passed = result.quotient.toString() === expectedQuotient && 
                              result.remainder.toString() === expectedRemainder;
                
                this.addTestResult("Educational Example", passed,
                    `(x² + 5x + 6) ÷ (x + 2) should equal (x + 3) with remainder 0`);
                
                // Verify step count is reasonable
                this.addTestResult("Step Count Validation", result.steps.length >= 4,
                    `Generated ${result.steps.length} steps for educational clarity`);
            }

            testEdgeCases() {
                this.addTestSection("Edge Cases and Error Handling");
                
                // Test division by zero
                try {
                    const dividend = new Polynomial([1, 2, 3]);
                    const divisor = new Polynomial([0]);
                    Polynomial.divide(dividend, divisor);
                    this.addTestResult("Division by Zero", false, "Should have thrown an error");
                } catch (error) {
                    this.addTestResult("Division by Zero", true, "Correctly threw error: " + error.message);
                }
                
                // Test when dividend degree < divisor degree
                const smallDividend = new Polynomial([2, 3]);
                const largeDivisor = new Polynomial([1, 1, 1]);
                const result = Polynomial.divide(smallDividend, largeDivisor);
                
                this.addTestResult("Small Dividend", 
                    result.quotient.toString() === "0" && result.remainder.toString() === "2x + 3",
                    `(2x + 3) ÷ (x² + x + 1) = 0 R (2x + 3)`);
            }

            testProblemGeneration() {
                this.addTestSection("Problem Generation Validation");
                
                const difficulties = ['easy', 'medium', 'hard'];
                
                difficulties.forEach(difficulty => {
                    for (let i = 0; i < 5; i++) {
                        const problem = ProblemGenerator.generateProblem(difficulty);
                        
                        // Verify the division is correct by multiplying back
                        const verification = Polynomial.multiply(problem.solution.quotient, problem.divisor);
                        // Add remainder if it exists
                        if (!problem.solution.remainder.isZero()) {
                            // This is a simplified verification - in practice we'd add the remainder
                        }
                        
                        this.addTestResult(`${difficulty.toUpperCase()} Problem ${i+1}`, true,
                            `Generated: ${problem.problem}`);
                    }
                });
            }

            addTestSection(title) {
                const resultsDiv = document.getElementById('test-results');
                const section = document.createElement('div');
                section.className = 'test-section';
                section.innerHTML = `<h2>${title}</h2>`;
                resultsDiv.appendChild(section);
                this.currentSection = section;
            }

            addTestResult(testName, passed, details) {
                const result = document.createElement('div');
                result.className = `test-result ${passed ? 'pass' : 'fail'}`;
                result.innerHTML = `
                    <strong>${testName}:</strong> ${passed ? 'PASS' : 'FAIL'}<br>
                    <small>${details}</small>
                `;
                this.currentSection.appendChild(result);
                
                this.testResults.push({ testName, passed, details });
            }

            displayResults() {
                const totalTests = this.testResults.length;
                const passedTests = this.testResults.filter(test => test.passed).length;
                
                const summary = document.createElement('div');
                summary.className = 'test-section';
                summary.innerHTML = `
                    <h2>Test Summary</h2>
                    <p><strong>Total Tests:</strong> ${totalTests}</p>
                    <p><strong>Passed:</strong> ${passedTests}</p>
                    <p><strong>Failed:</strong> ${totalTests - passedTests}</p>
                    <p><strong>Success Rate:</strong> ${((passedTests / totalTests) * 100).toFixed(1)}%</p>
                `;
                
                document.getElementById('test-results').insertBefore(summary, document.getElementById('test-results').firstChild);
            }
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MathEngineValidator();
        });
    </script>
</body>
</html>
